name: "ðŸ”„ Sync all branches with main"

on:
  workflow_dispatch:

jobs:
  sync_branches:
    runs-on: ubuntu-latest
    name: "ðŸ”„ Sync branches with main"

    env:
      EMAIL: ${{ secrets.GH_EMAIL }}
      NAME: ${{ secrets.GH_USERNAME }}
      TOKEN: ${{ secrets.TOKEN }}
      BRANCH_BASE_NAME: proxyip
      BRANCH_COUNT: 200

    steps:
      - name: ðŸ›  Set Git config
        run: |
          git config --global user.email "${EMAIL}"
          git config --global user.name "${NAME}"

      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.TOKEN }}
          fetch-depth: 0

      - name: ðŸ”„ Sync all branches with main
        run: |
          git fetch --all
          git checkout main
          git pull origin main

          for ((i=1; i<=${BRANCH_COUNT}; i++)); do
            BR="${BRANCH_BASE_NAME}${i}"

            # Check if branch exists
            if git show-ref --verify --quiet refs/heads/$BR; then
              echo "âž¡ Syncing $BR"
              git checkout $BR
              git merge main --no-edit || true
              git push origin $BR
              git checkout main
            else
              echo "âŒ Branch $BR does NOT exist, skipping."
            fi
          done
