name: "ğŸŒ² Create many branches"

on:
  workflow_dispatch:

jobs:
  create_branches:
    runs-on: ubuntu-latest
    name: "ğŸŒ² Create and push branches"

    env:
      EMAIL: ${{ secrets.GH_EMAIL }}
      NAME: ${{ secrets.GH_USERNAME }}
      TOKEN: ${{ secrets.TOKEN }}
      REMOTE_NAME: origin
      BRANCH_BASE_NAME: proxyip
      BRANCH_COUNT: 300

    steps:
      - name: âš™ï¸ Set up Git config
        run: |
          git config --global user.email "${{ env.EMAIL }}"
          git config --global user.name "${{ env.NAME }}"

      - name: ğŸ“¦ Clone repository
        run: |
          git clone https://${{ env.TOKEN }}@github.com/${{ github.repository }}.git repo

      - name: ğŸŒ¿ Create and push branches
        run: |
          cd repo

          # Ensure main branch exists and is updated
          git fetch origin
          git checkout main || git checkout -b main

          for ((i=1; i<=${{ env.BRANCH_COUNT }}; i++)); do
              branch_name="${{ env.BRANCH_BASE_NAME }}${i}"

              echo "Creating $branch_name ..."

              git checkout -b $branch_name
              git commit --allow-empty -m "Create branch ${branch_name}"
              git push ${{ env.REMOTE_NAME }} $branch_name

              git checkout main
          done
